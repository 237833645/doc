

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>jffs2文件系统挂载不上的常见原因 &mdash; Lichee zero  文档</title>
  

  
  
    <link rel="shortcut icon" href="http://zero.lichee.pro/_static/icon.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="JFFS2文件系统简介" href="SPI_falsh_doc4.html" />
    <link rel="prev" title="overlayfs的使用" href="SPI_falsh_doc2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Lichee zero
          

          
            
            <img src="http://zero.lichee.pro/_static/icon2.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">初来乍到篇:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../入门/intro_cn.html">荔枝派与创作者的自我介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../入门/tips.html">Linux使用小贴士</a></li>
<li class="toctree-l1"><a class="reference internal" href="../入门/board_intro.html">认识zero的硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../入门/docker_index.html">Docker环境简明教程</a></li>
</ul>
<p class="caption"><span class="caption-text">系统开发篇:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="type.html">Zero的开发环境分类</a></li>
<li class="toctree-l1"><a class="reference internal" href="uboot_index.html">UBOOT适配</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel_index.html">Linux内核编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="bsp_index.html">BSP内核编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="filesys_index.html">根文件系统编译</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="SPI_index.html">SPI系统杂谈</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="SPI_flash_build.html">SPI Flash 系统编译</a></li>
<li class="toctree-l2"><a class="reference internal" href="SPI_falsh_doc1.html">sunxi-fel增加对16M以上Flash的支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="SPI_falsh_doc2.html">overlayfs的使用</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="SPI_falsh_doc3.html#">jffs2文件系统挂载不上的常见原因</a><ul>
<li class="toctree-l3"><a class="reference internal" href="SPI_falsh_doc3.html#id2">内核命令行不正确</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPI_falsh_doc3.html#id3">识别不到分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPI_falsh_doc3.html#jffs2-magic-bitmask">jffs2 Magic bitmask 错误</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPI_falsh_doc3.html#id4">其它摘录</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SPI_falsh_doc4.html">JFFS2文件系统简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="SPI_falsh_doc5.html">uboot 对SPI flash 的识别</a></li>
<li class="toctree-l2"><a class="reference internal" href="SPI_falsh_doc6.html">关于系统reboot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="download_index.html">Zero 镜像烧录</a></li>
<li class="toctree-l1"><a class="reference internal" href="Imager.html">Zero Imager的使用</a></li>
</ul>
<p class="caption"><span class="caption-text">驱动开发篇:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../驱动/Device_Tree_Intro.html">设备树简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../驱动/peripheral_index.html">外设适配</a></li>
<li class="toctree-l1"><a class="reference internal" href="../驱动/device_index.html">设备驱动</a></li>
</ul>
<p class="caption"><span class="caption-text">应用开发篇:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../应用/autorun.html">开机自启动</a></li>
<li class="toctree-l1"><a class="reference internal" href="../应用/debug.html">Segment Fault调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../应用/otg2PC.html">Zero通过otg与PC共享网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../应用/USB_cam.html">USB摄像头使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../应用/QT_index.html">基于QT的GUI开发</a></li>
</ul>
<p class="caption"><span class="caption-text">贡献投稿篇:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../贡献/todolist.html">荔枝派任务领取</a></li>
<li class="toctree-l1"><a class="reference internal" href="../贡献/contents.html">投稿文章精选</a></li>
<li class="toctree-l1"><a class="reference internal" href="../贡献/build_doc.html">文档构建</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Lichee zero</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="SPI_index.html">SPI Flash 杂谈</a> &raquo;</li>
        
      <li>jffs2文件系统挂载不上的常见原因</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="jffs2">
<h1><a class="toc-backref" href="SPI_falsh_doc3.html#id6">jffs2文件系统挂载不上的常见原因</a><a class="headerlink" href="SPI_falsh_doc3.html#jffs2" title="永久链接至标题">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">本文目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="SPI_falsh_doc3.html#jffs2" id="id6">jffs2文件系统挂载不上的常见原因</a></p>
<ul>
<li><p><a class="reference internal" href="SPI_falsh_doc3.html#id2" id="id7">内核命令行不正确</a></p></li>
<li><p><a class="reference internal" href="SPI_falsh_doc3.html#id3" id="id8">识别不到分区</a></p></li>
<li><p><a class="reference internal" href="SPI_falsh_doc3.html#jffs2-magic-bitmask" id="id9">jffs2 Magic bitmask 错误</a></p></li>
<li><p><a class="reference internal" href="SPI_falsh_doc3.html#id4" id="id10">其它摘录</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="SPI_falsh_doc3.html#id7">内核命令行不正确</a><a class="headerlink" href="SPI_falsh_doc3.html#id2" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">0.000000</span><span class="p">]</span> <span class="n">Kernel</span> <span class="n">command</span> <span class="n">line</span><span class="p">:</span> <span class="n">console</span><span class="o">=</span><span class="n">ttyS0</span><span class="p">,</span><span class="mi">115200</span> <span class="n">earlyprintk</span> <span class="n">panic</span><span class="o">=</span><span class="mi">5</span> <span class="n">rootwait</span> <span class="n">mtdparts</span><span class="o">=</span><span class="n">spi32766</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="n">M</span><span class="p">(</span><span class="n">uboot</span><span class="p">)</span><span class="n">ro</span><span class="p">,</span><span class="mi">64</span><span class="n">k</span><span class="p">(</span><span class="n">dtb</span><span class="p">)</span><span class="n">ro</span><span class="p">,</span><span class="mi">4</span><span class="n">M</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span><span class="n">ro</span><span class="p">,</span><span class="mi">3008</span><span class="n">k</span><span class="p">(</span><span class="n">rootfs</span><span class="p">)</span> <span class="n">root</span><span class="o">=</span><span class="mi">31</span><span class="p">:</span><span class="mi">03</span> <span class="n">rw</span> <span class="n">rootfstype</span><span class="o">=</span><span class="n">jffs2</span>
</pre></div>
</div>
<p>内核命令行应正确显示分区信息，如果分区信息不正确则无法正确挂载。</p>
<p>分区信息在 <em>include/configs/sun8i.h</em> 里修改</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">vi include/configs/sun8i.h</span><a class="headerlink" href="SPI_falsh_doc3.html#id5" title="永久链接至代码">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="cp">#define CONFIG_BOOTCOMMAND   &quot;sf probe 0; &quot;                           \</span>
<span class="cp">                             &quot;sf read 0x41800000 0x100000 0x10000; &quot;  \</span>
<span class="cp">                             &quot;sf read 0x41000000 0x110000 0x400000; &quot; \</span>
<span class="cp">                             &quot;bootz 0x41000000 - 0x41800000&quot;</span>

 <span class="cp">#define CONFIG_BOOTARGS      &quot;console=ttyS0,115200 earlyprintk panic=5 rootwait &quot; \</span>
<span class="cp">                             &quot;mtdparts=spi32766.0:1M(uboot)ro,64k(dtb)ro,4M(kernel)ro,-(rootfs) root=31:03 rw rootfstype=jffs2&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="SPI_falsh_doc3.html#id8">识别不到分区</a><a class="headerlink" href="SPI_falsh_doc3.html#id3" title="永久链接至标题">¶</a></h2>
<p>正常识别到分区，应该报以下信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>    <span class="mf">0.862858</span><span class="p">]</span> <span class="n">m25p80</span> <span class="n">spi32766</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span> <span class="n">w25q128</span> <span class="p">(</span><span class="mi">16384</span> <span class="n">Kbytes</span><span class="p">)</span>
<span class="p">[</span>    <span class="mf">0.867927</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cmdline</span> <span class="n">partion</span>
<span class="p">[</span>    <span class="mf">0.871123</span><span class="p">]</span> <span class="n">p4</span> <span class="p">:</span> <span class="n">size</span><span class="o">=</span><span class="mi">100000</span>
<span class="p">[</span>    <span class="mf">0.874005</span><span class="p">]</span> <span class="n">p4</span> <span class="p">:</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span>
<span class="p">[</span>    <span class="mf">0.876796</span><span class="p">]</span> <span class="n">p4</span> <span class="p">:</span> <span class="n">size</span><span class="o">=</span><span class="mi">400000</span>
<span class="p">[</span>    <span class="mf">0.879714</span><span class="p">]</span> <span class="n">p4</span> <span class="p">:</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="n">f0000</span>
<span class="p">[</span>    <span class="mf">0.882596</span><span class="p">]</span> <span class="n">spi32766</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span> <span class="n">parser</span> <span class="n">cmdlinepart</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">[</span>    <span class="mf">0.886949</span><span class="p">]</span> <span class="mi">4</span> <span class="n">cmdlinepart</span> <span class="n">partitions</span> <span class="n">found</span> <span class="n">on</span> <span class="n">MTD</span> <span class="n">device</span> <span class="n">spi32766</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span>    <span class="mf">0.893230</span><span class="p">]</span> <span class="n">Creating</span> <span class="mi">4</span> <span class="n">MTD</span> <span class="n">partitions</span> <span class="n">on</span> <span class="s2">&quot;spi32766.0&quot;</span><span class="p">:</span>
<span class="p">[</span>    <span class="mf">0.898374</span><span class="p">]</span> <span class="mh">0x000000000000</span><span class="o">-</span><span class="mh">0x000000100000</span> <span class="p">:</span> <span class="s2">&quot;uboot&quot;</span>
<span class="p">[</span>    <span class="mf">0.904828</span><span class="p">]</span> <span class="mh">0x000000100000</span><span class="o">-</span><span class="mh">0x000000110000</span> <span class="p">:</span> <span class="s2">&quot;dtb&quot;</span>
<span class="p">[</span>    <span class="mf">0.910973</span><span class="p">]</span> <span class="mh">0x000000110000</span><span class="o">-</span><span class="mh">0x000000510000</span> <span class="p">:</span> <span class="s2">&quot;kernel&quot;</span>
<span class="p">[</span>    <span class="mf">0.917258</span><span class="p">]</span> <span class="mh">0x000000510000</span><span class="o">-</span><span class="mh">0x000000800000</span> <span class="p">:</span> <span class="s2">&quot;rootfs&quot;</span>
</pre></div>
</div>
<p>如果没有显示以上信息，则需要确认有无勾选相关驱动</p>
<p>进入到 <span class="menuselection">Device Drivers ‣ Memory Technology Device (MTD) support</span> ，</p>
<p>确保选择上mtd的 <strong>&lt;*&gt; Command line partition table parsing</strong> 支持，该项目用来解析uboot传递过来的flash分区信息。</p>
<p>以及SPI-NOR 设备的支持。</p>
<p>添加对jffs2文件系统的支持，路径在 <span class="menuselection">File systems ‣ Miscellaneous filesystems ‣ Journalling Flash File System v2 (JFFS2) support</span></p>
</div>
<div class="section" id="jffs2-magic-bitmask">
<h2><a class="toc-backref" href="SPI_falsh_doc3.html#id9">jffs2 Magic bitmask 错误</a><a class="headerlink" href="SPI_falsh_doc3.html#jffs2-magic-bitmask" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jffs2: Node at 0x00000f6c with length 0x00000144 would run over the end of the erase block
[    1.133830] jffs2: Perhaps the file system was created with the wrong erase size?
[    1.141435] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f70: 0x0144 instead
[    1.150994] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f74: 0x912a instead
[    1.160547] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f78: 0x0002 instead
[    1.170127] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f7c: 0x000d instead
[    1.180689] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f80: 0x81a4 instead
[    1.190183] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f84: 0x03e8 instead
[    1.199668] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f88: 0x11d8 instead
[    1.209151] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f8c: 0xdec2 instead
[    1.218634] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f90: 0xdec2 instead
[    1.228102] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000f94: 0xdec2 instead
[    1.237581] jffs2: Further such events for this erase block will not be printed
[    1.245110] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001000: 0x3fb1 instead
[    1.254615] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001004: 0x1a28 instead
[    1.264102] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001008: 0x7f01 instead
[    1.273586] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000100c: 0x505d instead
[    1.283098] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001010: 0x84c8 instead
[    1.292588] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001014: 0xd8d1 instead
[    1.302072] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001018: 0x4001 instead
[    1.311555] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000101c: 0x8485 instead
[    1.321033] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001020: 0x65b1 instead
[    1.330514] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00001024: 0x5d81 instead
</pre></div>
</div>
<p>该错误有若干种可能：</p>
<ol class="arabic">
<li><p>jffs2镜像生成错误</p>
<p><code class="docutils literal notranslate"><span class="pre">mkfs.jffs2</span> <span class="pre">-s</span> <span class="pre">0x100</span> <span class="pre">-e</span> <span class="pre">0x10000</span> <span class="pre">-p</span> <span class="pre">0xAF0000</span> <span class="pre">-d</span> <span class="pre">rootfs-brmin</span> <span class="pre">-o</span> <span class="pre">jffs2-brmin.img</span></code></p>
<ul class="simple">
<li><p>这里-s代表页大小，普通spi nor flash的页大小是256字节，即0x100</p></li>
<li><p>-e表示擦除的块大小，普通spi nor flash的块大小是64K字节，即0x10000</p></li>
<li><p>-p表示分区大小，在生成时会擦除分区大小的flash初始化。</p></li>
<li><p>这里必须和uboot里指定的分区大小一致，否则会出现脏页。</p></li>
</ul>
</li>
<li><p>内核使用了扇区擦除</p>
<ul class="simple">
<li><p>mkfs.jffs2 使用的最小擦除尺寸是8KB，而spi flash的扇区大小是4KB，所以按照扇区擦除的话，会无法使用，所以必须使用块擦除。</p></li>
<li><p>编译内核前先确认下drivers/mtd/spi-nor/spi-nor.c里，自己使用的flash的相关信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">SECT_4K</span> <span class="pre">BIT(0)</span> <span class="pre">/*</span> <span class="pre">SPINOR_OP_BE_4K</span> <span class="pre">works</span> <span class="pre">uniformly</span> <span class="pre">*/</span></code></p></li>
<li><p>如果发现信息里有SECT_4K，则会导致jffs2不能正常擦除（64KB），需要去掉该flag。</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="SPI_falsh_doc3.html#id10">其它摘录</a><a class="headerlink" href="SPI_falsh_doc3.html#id4" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Question1：JFFS2 error: (1) jffs2_build_inode_pass1: child dir &quot;alsa&quot; (ino #1159) of dir ino #1074 appears to be a hard link
JFFS2 error: (1) jffs2_build_inode_pass1: child dir &quot;l&quot; (ino #1170) of dir ino #1075 appears to be a hard link
原由 : flash没有erase彻底.
VFS: Mounted root (jffs2 filesystem) on device 31:1. Freeing init memory: 136K
JFFS2 notice: (1) check_node_data: wrong data CRC in data node at 0x0f0a7f78: read 0x4462b066, calculated 0x48ea177f.
JFFS2 error: (488) jffs2_do_read_inode_internal: Argh. Special inode #139 with mode 0x61b0 had more than one node iget() failed for ino #139 mknod: /dev/null: File exists
Populating /dev using udev: udevd (499): /proc/499/oom_adj is deprecated, please use /proc/499/oom_score_adj instead.
JFFS2 error: (500) jffs2_do_read_inode_internal: Argh. Special inode #1123 with mode 0x21b0 had more than one node iget() failed for ino #1123
Question2：jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000024: 0x2b10 instead
mkfs.jffs2 -s 的参数问题 对照FLASH的大小再重新生成镜像文件过即可 The answer this means that the data on your flash device is not a valid JFFS2 file system.
There is no single solution for this problem, but we will try to provide you some ideas how to fix this.
The first question you should try to answer is &quot;why the data on my flash device is incorrect so that JFFS2 rejects to deal with it?&quot;. There are may be a plenty of reasons, e.g.:
you flash driver is severely buggy so it reads trash instead of valid data;
you flashed some trash instead of a valid JFFS2 image;
you did not manage to flash JFFS2 image correctly so that you ended up with
garbage on your flash, although the original image was perfectly fine;
you forgot to erase your flash before flashing it, etc.
Anyways, JFFS2 wouldn&#39;t complain if it was able to find correct data. As it does complain, there is something wrong with the data it reads.
One common mistake is to use /dev/mtdX or /dev/mtdblockX devices to flash JFFS2 images on NAND flashes. E.g.
cp jffs2_fs.img /dev/mtd2
This is incorrect because when dealing with NAND flashes one has to skip bad
eraseblocks and write only in NAND page size chunks. Please, use the nandwrite utility instead.
Also please, do not forget to erase your flash before flashing the image. You may use the
flash_eraseall utility for this. And it makes sense to make sure the erase functionality
actually works by reading the erased MTD device back and checking that only 0xFF bytes were read.
You may try to check if your flash driver works correctly and if you flashed the file system image correctly by means of reading the flash back after you have flashed your image, and compare the read image with the original one. Please, use the nandread utility to read from NAND flashes.
You can also do the following experiment to make sure JFFS2 works well. Erase your MTD device and mount it to JFFS2. You will end up with an empty file system. Copy some files to the JFFS2 file system and unmount it. Then mount it again and see if it mounts without problems. If it does, this is most probably not a JFFS2 bug.
Question3：Empty flash at 0xXXXXXXXX ends at 0xXXXXXXXX
This message is generated if a block of data is partially written. It is generally not a sign of any problem.
Question4：Name CRC failed on node at 0x00b620c8: Read 0x640c8ca3, calculated 0x795111fe
重启，则不会有如上CRC错误信息。 问题原因：
我在烧写jffs2 img之前，使用fis init -f 来擦除flash。fis init -f 命令执行完以后，flash空间就都是0xFF了！即使在mkfs.jffs2的时候使用&#39;-p&#39;参数指定最终输出img的大小，但是超出文件系统的部分也会被填充为0xFF!但这可不是jffs2的格式！
我用fis create分了5M多（0x590000）的分区，但是jffs2fs.img只有不到3M（0x250000），那么把它烧写到flash以后，分区中除了jffs2 img之外剩余的flash空间（大概2M）全是0xFF，这不是jffs2要求的格式，所以，会发出CRC错误的信息。假如有一种工具，他可以将flash format为jffs2的格式，那么就不会出现这个问题了。目前我还没有找到这种工具，但是，可以确信的是：上面的CRC错误是不影响jffs2文件系统的使用
http://blog.chinaunix.net/space.php?uid=20727076&amp;do=blog&amp;id=1885384

Question5: VFS: Mounted root (jffs2 filesystem) readonly.
Freeing unused kernel memory: 304k freed Error -3 while decompressing! 804878c4(1884)-&gt;81200000(16384)
Failed to execute /linuxrc. Attempting defaults...
Kernel panic - not syncing: No init found. Try passing init= option to kernel.
原由 : 没有仔细看 mkfs.jffs2 的手册, 须要指定-b参数, 大小与PAGE_SIZE一样 (查看.config文件 CONFIG_PAGE_SIZE_16KB=y).
Question6:
共提示以下几种错误：
Empty flash at 0x00258c88 ends at 0x00258c8c
jffs2_scan_inode_node(): CRC failed on node at 0x002873f0: Read 0x50dc72ec, calculated 0xafbffd1d
jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x002d24ac: 0x000d instead JFFS2 notice: (1) jffs2_build_xattr_subsystem: complete building xattr subsystem, 0 of xdatum (0 unchecked, 0 orphan) and 0 of xref (0 dead, 0 orphan) found. VFS: Mounted root (jffs2 filesystem). Freeing init memory: 124K
JFFS2 notice: (1) check_node_data: wrong data CRC in data node at 0x00012000: read 0x1a9bfab2, calculated 0xdc27bef6.
JFFS2 notice: (728) read_dnode: wrong data CRC in data node at 0x0000e438: read 0x3dcf6001, calculated 0xcb81f1ee.
JFFS2 warning: (1) jffs2_do_read_inode_internal: no data nodes found for ino #14 JFFS2 notice: (1) jffs2_do_read_inode_internal: but it has children so we fake some modes for it
Failed to execute /linuxrc. Attempting defaults...
Kernel panic - not syncing: No init found. Try passing init= option to kernel. 分析：
记得JFFS2是采用自己的ECC算法，但是在内核中又打开了S3C2410_HARDWARE_ECC 解决方案： 去掉硬件ECC
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SPI_falsh_doc4.html" class="btn btn-neutral float-right" title="JFFS2文件系统简介" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="SPI_falsh_doc2.html" class="btn btn-neutral float-left" title="overlayfs的使用" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Lichee Pi

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<meta http-equiv="Cache-Control" max-age=7200 />

<!-- <a href="https://github.com/Lichee-Pi">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67"
        alt="Fork LicheePi on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png">
</a> -->

<a href="https://github.com/Lichee-Pi" class="github-corner" aria-label="View source on Github">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#2980B9; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
            fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
            fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>
    .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
    
    @keyframes octocat-wave {
        0%,
        100% {
            transform: rotate(0)
        }
        20%,
        60% {
            transform: rotate(-25deg)
        }
        40%,
        80% {
            transform: rotate(10deg)
        }
    }
    
    @media (max-width:500px) {
        .github-corner:hover .octo-arm {
            animation: none
        }
        .github-corner .octo-arm {
            animation: octocat-wave 560ms ease-in-out
        }
    }
</style>

<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNDA5Mi8xMDYzMA==">
    <script type="text/javascript">
        (function(d, s) {
            var j, e = d.getElementsByTagName(s)[0];

            if (typeof LivereTower === 'function') {
                return;
            }

            j = d.createElement(s);
            j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
            j.async = true;

            e.parentNode.insertBefore(j, e);
        })(document, 'script');
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->
<!-- End of Chaport Live Chat code -->
  

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>