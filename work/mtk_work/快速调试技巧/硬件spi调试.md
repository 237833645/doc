# MTK硬件SPI设备驱动调试

## MTK SPI代码架构关键信息描述

- 描述：
  - MTK SPI总线如果使用的是硬件SPI才可以用较高的速率来完成SPI通讯，例如SPI的LCD，如果使用软件模拟的只能是较慢速率通讯的设备（硬件不是接在SPI总线接口）
  - MTK在lk阶段是没有支持硬件SPI功能，所以如果想在lk阶段让SPI工作就必须用软件模拟SPI的方案，如果是SPI的屏幕在次阶段调试时经常会出现开机logo正常，开机动画花屏问题
  - MTK的硬件SPI智能工作在Master模式，clock必须要满足Slave设备要求的工作时钟，太高会出现数据不对，如果SPI经过电平转换走线较长，建议降低SPI的clock速率，来保证传输的正确性
  - 如果使用的不是类似LCD的大数据通讯，建议不要开启DMA模式，只使用32bit通讯即可
  - SPI总线全双工通信过程必须先发送Master Send，然后再Master Receive，如果不是这样的逻辑会读取错误的数据回来
  - MTK为每个平台都默认适配了SPI的驱动代码，有些平台是没有进行适配，这点很关键。
  - 调试时，先调试Master Send功能，用逻辑分析仪查看是否数据正确，在调试Slave设备的Send，最后连调，并抓取信号分析是否正常

## SPI总线操作代码片段

## 附件为SPI的demo包（供参考）

## 小结